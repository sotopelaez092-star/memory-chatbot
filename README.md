# AIèŠå¤©æœºå™¨äººè®°å¿†ç³»ç»Ÿï¼šä»ç†è®ºåˆ°å®è·µ

> ä¸€ä¸ªå®Œæ•´çš„AIèŠå¤©æœºå™¨äººè®°å¿†ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«4ç§å‹ç¼©ç­–ç•¥å’Œå®Œæ•´çš„æ€§èƒ½æµ‹è¯•æ•°æ®

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ª**ç”Ÿäº§çº§**çš„AIèŠå¤©æœºå™¨äººè®°å¿†ç³»ç»Ÿï¼Œè§£å†³äº†å¯¹è¯å†å²ç®¡ç†ä¸­çš„æ ¸å¿ƒé—®é¢˜ï¼š

- âœ… å¦‚ä½•é«˜æ•ˆå­˜å‚¨å¯¹è¯å†å²
- âœ… å¦‚ä½•åœ¨Tokené™åˆ¶ä¸‹ä¿ç•™å…³é”®ä¿¡æ¯
- âœ… å¦‚ä½•å¹³è¡¡é€Ÿåº¦ã€æˆæœ¬å’Œä¿¡æ¯ä¿ç•™

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- ğŸš€ 4ç§å‹ç¼©ç­–ç•¥ï¼ˆæ»‘åŠ¨çª—å£ã€LLMæ‘˜è¦ã€æ··åˆç­–ç•¥ã€TokenåŠ¨æ€ï¼‰
- ğŸ“Š å®Œæ•´çš„æ€§èƒ½æµ‹è¯•å’Œå¯¹æ¯”æ•°æ®
- ğŸ¯ çœŸå®åœºæ™¯çš„æœ€ä½³å®è·µå»ºè®®
- ğŸ’¡ åç›´è§‰çš„å‘ç°å’Œå·¥ç¨‹æ™ºæ…§

## ğŸ¯ æ ¸å¿ƒå‘ç°

é€šè¿‡å¤§é‡æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€äº›**åç›´è§‰**çš„ç»“æœï¼š

### å‘ç°1ï¼šLLMæ‘˜è¦åœ¨çŸ­å¯¹è¯ä¸­æ˜¯"è´Ÿä¼˜åŒ–"

```
çŸ­å¯¹è¯ï¼ˆ5è½®ï¼Œ126 tokensï¼‰ï¼š
- åŸå§‹ï¼š126 tokens
- LLMæ‘˜è¦åï¼š303 tokensï¼ˆå¢åŠ 141%ï¼ï¼‰âŒ

ç»“è®ºï¼šåªæœ‰â‰¥30è½®æ—¶ï¼ŒLLMæ‘˜è¦æ‰æœ‰æ­£æ”¶ç›Š
```

### å‘ç°2ï¼šæœ€"è ¢"çš„ç­–ç•¥å¾€å¾€æœ€å¥½

```
æ»‘åŠ¨çª—å£ï¼ˆæœ€ç®€å•ï¼‰ï¼š
âœ… Tokenæœ€å°‘ï¼ˆ145ï¼‰
âœ… é€Ÿåº¦æœ€å¿«ï¼ˆ0.00msï¼‰
âœ… æˆæœ¬æœ€ä½ï¼ˆ$0ï¼‰
âœ… æœ€å¯é 

LLMæ‘˜è¦ï¼ˆæœ€æ™ºèƒ½ï¼‰ï¼š
âŒ Tokenæœ€å¤šï¼ˆ597ï¼‰
âŒ é€Ÿåº¦æœ€æ…¢ï¼ˆ11,663msï¼‰
âŒ æˆæœ¬æœ€é«˜ï¼ˆ$0.0001/æ¬¡ï¼‰

ç»“è®ºï¼š80%åœºæ™¯ç”¨æœ€ç®€å•çš„æ–¹æ¡ˆå°±å¤Ÿäº†
```

### å‘ç°3ï¼šæ²¡æœ‰"å®Œç¾"çš„ç­–ç•¥

| ç­–ç•¥ | Token | é€Ÿåº¦ | æˆæœ¬ | ä¿¡æ¯ä¿ç•™ |
|------|-------|------|------|----------|
| æ»‘åŠ¨çª—å£ | â­æœ€å°‘ | â­æœ€å¿« | â­$0 | âŒ0% |
| LLMæ‘˜è¦ | âŒæœ€å¤š | âŒæœ€æ…¢ | âŒæœ€è´µ | â­100% |
| æ··åˆç­–ç•¥ | ä¸­ç­‰ | è§†æƒ…å†µ | ä¸­ç­‰ | â­100% |
| TokenåŠ¨æ€ | è¾ƒå°‘ | â­å¾ˆå¿« | â­$0 | ä¾èµ–é¢„ç®— |

**æ ¸å¿ƒæ•™è®­ï¼šTrade-offæ— å¤„ä¸åœ¨ï¼Œé€‰æ‹©é€‚åˆåœºæ™¯çš„ç­–ç•¥ã€‚**

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
memory-chatbot/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”œâ”€â”€ base.py           # LLMåŸºç±»æ¥å£
â”‚   â”‚   â””â”€â”€ deepseek.py       # DeepSeekå®ç°
â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â”œâ”€â”€ short_term.py     # çŸ­æœŸè®°å¿†ï¼ˆDequeå®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ compressor.py     # 4ç§å‹ç¼©ç­–ç•¥
â”‚   â””â”€â”€ chatbot.py            # å®Œæ•´èŠå¤©æœºå™¨äºº
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_data.py          # æµ‹è¯•æ•°æ®ç”Ÿæˆ
â”‚   â”œâ”€â”€ test_short_term.py    # çŸ­æœŸè®°å¿†æµ‹è¯•
â”‚   â”œâ”€â”€ test_sliding_window.py # æ»‘åŠ¨çª—å£æµ‹è¯•
â”‚   â”œâ”€â”€ test_llm_summary.py   # LLMæ‘˜è¦æµ‹è¯•
â”‚   â”œâ”€â”€ test_hybrid.py        # æ··åˆç­–ç•¥æµ‹è¯•
â”‚   â””â”€â”€ test_token_based.py   # TokenåŠ¨æ€æµ‹è¯•
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ requirements.txt          # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/memory-chatbot.git
cd memory-chatbot

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .envï¼Œå¡«å…¥ä½ çš„APIå¯†é’¥
DEEPSEEK_API_KEY=your_api_key_here
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# æµ‹è¯•æ»‘åŠ¨çª—å£ç­–ç•¥
python tests/test_sliding_window.py

# æµ‹è¯•LLMæ‘˜è¦ç­–ç•¥
python tests/test_llm_summary.py

# æµ‹è¯•æ··åˆç­–ç•¥
python tests/test_hybrid.py

# æµ‹è¯•TokenåŠ¨æ€ç­–ç•¥
python tests/test_token_based.py
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•æ•°æ®

### é•¿å¯¹è¯åœºæ™¯ï¼ˆ20è½®ï¼Œ560 tokensï¼‰

| ç­–ç•¥ | Token | å‹ç¼©ç‡ | é€Ÿåº¦ | æˆæœ¬ | ä¿¡æ¯ä¿ç•™ |
|------|-------|--------|------|------|----------|
| **æ»‘åŠ¨çª—å£** | **145** | **74%** | **0.00ms** | **$0** | 0% |
| TokenåŠ¨æ€ | 193 | 66% | 0.53ms | $0 | ä¾èµ–é¢„ç®— |
| LLMæ‘˜è¦ | 597 | -7% | 13,446ms | $0.0001 | 100% |
| æ··åˆç­–ç•¥ | 604 | -8% | 11,663ms | $0.0001 | 100% |

### ä¿¡æ¯ä¿ç•™æµ‹è¯•ï¼ˆ15è½®å¯¹è¯ï¼Œ5ä¸ªå…³é”®ä¿¡æ¯ï¼‰

| ç­–ç•¥ | ä¿ç•™ç‡ | è¯¦æƒ… |
|------|-------|------|
| æ»‘åŠ¨çª—å£ | 0% | å…¨éƒ¨ä¸¢å¤± âŒ |
| LLMæ‘˜è¦ | 100% | å…¨éƒ¨ä¿ç•™ âœ… |
| æ··åˆç­–ç•¥ | 100% | å…¨éƒ¨ä¿ç•™ âœ… |
| TokenåŠ¨æ€(é¢„ç®—200) | 100% | å…¨éƒ¨ä¿ç•™ âœ… |

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šä½¿ç”¨æ»‘åŠ¨çª—å£ï¼ˆæœ€ç®€å•ï¼‰

```python
from src.memory.compressor import SlidingWindowCompressor

# åˆ›å»ºå‹ç¼©å™¨
compressor = SlidingWindowCompressor(keep_turns=5)

# å‹ç¼©å¯¹è¯å†å²
compressed = compressor.compress(messages)

print(f"å‹ç¼©å‰: {len(messages)}æ¡")
print(f"å‹ç¼©å: {len(compressed)}æ¡")
```

### ç¤ºä¾‹2ï¼šä½¿ç”¨æ··åˆç­–ç•¥ï¼ˆæ¨èï¼‰

```python
from src.memory.compressor import HybridCompressor
from src.llm.deepseek import DeepSeekLLM

# åˆå§‹åŒ–LLM
llm = DeepSeekLLM()

# åˆ›å»ºæ··åˆç­–ç•¥å‹ç¼©å™¨
compressor = HybridCompressor(
    llm,
    threshold_turns=10,    # 10è½®ä»¥ä¸‹ç”¨æ»‘åŠ¨çª—å£
    keep_recent_turns=5    # ä¿ç•™æœ€è¿‘5è½®
)

# è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥å‹ç¼©
compressed = compressor.compress(messages)
```

### ç¤ºä¾‹3ï¼šä½¿ç”¨TokenåŠ¨æ€ï¼ˆç²¾ç¡®æ§åˆ¶ï¼‰

```python
from src.memory.compressor import TokenBasedCompressor
from src.llm.deepseek import DeepSeekLLM

llm = DeepSeekLLM()

# åˆ›å»ºTokenåŠ¨æ€å‹ç¼©å™¨
compressor = TokenBasedCompressor(
    llm.count_tokens,
    max_tokens=200    # ç²¾ç¡®æ§åˆ¶åœ¨200 tokens
)

compressed = compressor.compress(messages)

# éªŒè¯Tokenæ•°
actual_tokens = sum(llm.count_tokens(m['content']) for m in compressed)
print(f"ç›®æ ‡: 200 tokens")
print(f"å®é™…: {actual_tokens} tokens")
print(f"è¯¯å·®: {abs(actual_tokens - 200)} tokens")
```

## ğŸ“ ç­–ç•¥é€‰æ‹©æŒ‡å—

### å¿«é€Ÿå†³ç­–æ ‘

```
å¯¹è¯é•¿åº¦â‰¤10è½®ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ã€æ»‘åŠ¨çª—å£ã€‘
â”‚        ç†ç”±ï¼šç®€å•ã€å¿«é€Ÿã€é›¶æˆæœ¬
â”‚
â””â”€ å¦ â†’ éœ€è¦ä¿ç•™ç”¨æˆ·ä¿¡æ¯ï¼Ÿ
    â”œâ”€ å¦ â†’ ã€æ»‘åŠ¨çª—å£ã€‘
    â”‚        ç†ç”±ï¼šTokenæ•ˆç‡æœ€é«˜
    â”‚
    â””â”€ æ˜¯ â†’ æœ‰Tokené¢„ç®—é™åˆ¶ï¼Ÿ
        â”œâ”€ æœ‰ â†’ ã€TokenåŠ¨æ€ã€‘
        â”‚        ç†ç”±ï¼šç²¾ç¡®æ§åˆ¶é¢„ç®—
        â”‚
        â””â”€ æ—  â†’ ã€æ··åˆç­–ç•¥ã€‘
                 ç†ç”±ï¼šè‡ªåŠ¨é€‚åº”ï¼Œä½“éªŒæœ€å¥½
```

### åœºæ™¯æ¨è

| åœºæ™¯ | æ¨èç­–ç•¥ | ç†ç”± |
|------|---------|------|
| FAQæœºå™¨äºº | æ»‘åŠ¨çª—å£ | å¯¹è¯çŸ­ï¼Œé€Ÿåº¦æœ€é‡è¦ |
| å®¢æœåŠ©æ‰‹ | æ··åˆç­–ç•¥ | è‡ªåŠ¨é€‚åº”ï¼Œä½“éªŒå¥½ |
| å¿ƒç†å’¨è¯¢ | LLMæ‘˜è¦ | å¿…é¡»è®°ä½æ‰€æœ‰ä¿¡æ¯ |
| APIç½‘å…³ | TokenåŠ¨æ€ | ç²¾ç¡®æ§åˆ¶Tokené™åˆ¶ |
| å…è´¹äº§å“ | æ»‘åŠ¨çª—å£ | é›¶æˆæœ¬ï¼Œå¯æ‰©å±• |
| VIPæœåŠ¡ | æ··åˆç­–ç•¥ | ç”¨æˆ·ä½“éªŒä¼˜å…ˆ |

## ğŸ”¬ æ ¸å¿ƒæŠ€æœ¯ç»†èŠ‚

### 1. æ»‘åŠ¨çª—å£ç­–ç•¥

**åŸç†ï¼š** å›ºå®šä¿ç•™æœ€è¿‘Nè½®å¯¹è¯

```python
def compress(self, messages):
    if len(messages) <= self.keep_messages:
        return messages
    return messages[-self.keep_messages:]
```

**ä¼˜ç‚¹ï¼š**
- é€Ÿåº¦ï¼š0.00msï¼ˆæå¿«ï¼‰
- æˆæœ¬ï¼š$0
- Tokenï¼šæœ€å°‘ï¼ˆ145ï¼‰
- ä»£ç ï¼š3è¡Œæ ¸å¿ƒä»£ç 

**ç¼ºç‚¹ï¼š**
- ä¸¢å¤±æ‰€æœ‰æ—©æœŸä¿¡æ¯
- ä¸æ™ºèƒ½

### 2. LLMæ‘˜è¦ç­–ç•¥

**åŸç†ï¼š** ç”¨LLMæ™ºèƒ½æ‘˜è¦å†å²ï¼Œä¿ç•™æœ€è¿‘Nè½®å®Œæ•´å¯¹è¯

```python
def compress(self, messages):
    if len(messages) <= self.keep_recent_messages:
        return messages
    
    # åˆ†å‰²å†å²å’Œæœ€è¿‘æ¶ˆæ¯
    history = messages[:-self.keep_recent_messages]
    recent = messages[-self.keep_recent_messages:]
    
    # LLMæ‘˜è¦å†å²
    summary = self._summarize(history)
    
    # ç»„åˆ
    return [{"role": "system", "content": summary}] + recent
```

**ä¼˜ç‚¹ï¼š**
- ä¿¡æ¯ä¿ç•™ï¼š100%
- æ™ºèƒ½æå–å…³é”®ä¿¡æ¯

**ç¼ºç‚¹ï¼š**
- çŸ­å¯¹è¯è´Ÿä¼˜åŒ–ï¼ˆTokenå¢åŠ 141%ï¼‰
- é€Ÿåº¦æ…¢ï¼ˆ11,663msï¼‰
- æœ‰æˆæœ¬ï¼ˆ$0.0001/æ¬¡ï¼‰

### 3. æ··åˆç­–ç•¥

**åŸç†ï¼š** çŸ­å¯¹è¯ç”¨æ»‘åŠ¨çª—å£ï¼Œé•¿å¯¹è¯ç”¨LLMæ‘˜è¦

```python
def compress(self, messages):
    turn_count = len(messages) // 2
    
    if turn_count <= self.threshold_turns:
        return self.sliding_window.compress(messages)
    else:
        return self.llm_summary.compress(messages)
```

**ä¼˜ç‚¹ï¼š**
- çŸ­å¯¹è¯ï¼šä¿æŒæ»‘åŠ¨çª—å£é€Ÿåº¦
- é•¿å¯¹è¯ï¼šä¿ç•™ç”¨æˆ·ä¿¡æ¯
- è‡ªåŠ¨é€‚åº”

**ç¼ºç‚¹ï¼š**
- é•¿å¯¹è¯Tokenå¤š4å€
- é˜ˆå€¼éœ€è¦è°ƒä¼˜

### 4. TokenåŠ¨æ€ç­–ç•¥

**åŸç†ï¼š** ç²¾ç¡®æ§åˆ¶åœ¨Tokené¢„ç®—å†…

```python
def compress(self, messages):
    total_tokens = sum(self.token_counter(m['content']) for m in messages)
    
    if total_tokens <= self.max_tokens:
        return messages
    
    # ä»æœ€æ—©å¼€å§‹åˆ é™¤
    compressed = messages[:]
    current_tokens = total_tokens
    
    while compressed and current_tokens > self.max_tokens:
        removed = compressed.pop(0)
        current_tokens -= self.token_counter(removed['content'])
    
    return compressed
```

**ä¼˜ç‚¹ï¼š**
- ç²¾ç¡®æ§åˆ¶ï¼ˆè¯¯å·®<5%ï¼‰
- é€Ÿåº¦å¿«ï¼ˆ0.53msï¼‰
- é›¶æˆæœ¬

**ç¼ºç‚¹ï¼š**
- å¯èƒ½æ¯”æ»‘åŠ¨çª—å£å¤šç”¨Token
- ä¿¡æ¯ä¿ç•™ä¾èµ–é¢„ç®—è®¾ç½®

## ğŸ“š è¯¦ç»†æ–‡ç« 

å®Œæ•´çš„å®ç°ç»†èŠ‚ã€æ€§èƒ½æµ‹è¯•ã€åç›´è§‰å‘ç°ï¼Œè¯·é˜…è¯»ï¼š

**æ˜é‡‘æ–‡ç« ï¼š** [AIèŠå¤©æœºå™¨äººè®°å¿†ç³»ç»Ÿï¼šä»é›¶åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆå®Œæ•´å®æˆ˜ï¼‰](ä½ çš„æ–‡ç« é“¾æ¥)

**æ–‡ç« ç›®å½•ï¼š**
1. èƒŒæ™¯å’ŒåŠ¨æœº
2. çŸ­æœŸè®°å¿†å®ç°ï¼ˆDeque vs Listï¼‰
3. å››ç§å‹ç¼©ç­–ç•¥è¯¦è§£
   - æ»‘åŠ¨çª—å£
   - LLMæ‘˜è¦
   - æ··åˆç­–ç•¥
   - TokenåŠ¨æ€
4. æ€§èƒ½æµ‹è¯•ä¸­çš„æ„å¤–å‘ç°
5. æœ€ä½³å®è·µå’Œå»ºè®®

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ å¼€æºåè®®

MIT License

## ğŸ‘¨â€ğŸ’» ä½œè€…

Tom - [@ä½ çš„GitHubç”¨æˆ·å](https://github.com/yourusername)

æ ¼æ€æ•™è‚² AIå·¥ç¨‹å¸ˆ

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰æä¾›åé¦ˆå’Œå»ºè®®çš„æœ‹å‹ï¼

---

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStar â­ï¸**